<html>
  <head>
    <title>Testing</title>
  </head>
  <body>
    <main>
      <div class="tabs">
        <div role="tablist" aria-label="Entertainment">
          <button
            role="tab"
            aria-selected="true"
            aria-controls="nils-tab"
            id="nils"
            data-testid="first-tab"
          >
            Nils Frahm
          </button>
          <button
            role="tab"
            aria-selected="false"
            aria-controls="agnes-tab"
            id="agnes"
            tabindex="-1"
          >
            Agnes Obel
          </button>
          <button
            role="tab"
            aria-selected="false"
            aria-controls="complexcomplex"
            id="complex"
            tabindex="-1"
            data-deletable=""
          >
            Joke
          </button>
        </div>
        <div tabindex="0" role="tabpanel" id="nils-tab" aria-labelledby="nils">
          <p>
            He is a German musician, composer and record producer based in
            Berlin. He is known for combining classical and electronic music and
            for an unconventional approach to the piano in which he mixes a
            grand piano, upright piano, Roland Juno-60, Rhodes piano, drum
            machine, and Moog Taurus.
          </p>
        </div>
        <div
          tabindex="0"
          role="tabpanel"
          id="agnes-tab"
          aria-labelledby="agnes"
          hidden=""
        >
          <p>
            She is a Danish singer/songwriter. Her first album, Philharmonics,
            was released by PIAS Recordings on 4 October 2010 in Europe.
            Philharmonics was certified gold in June 2011 by the Belgian
            Entertainment Association (BEA) for sales of 10,000 Copies.
          </p>
        </div>
        <div
          tabindex="0"
          role="tabpanel"
          id="complexcomplex"
          aria-labelledby="complex"
          hidden=""
        >
          <p>Fear of complicated buildings:</p>
          <p>A complex complex complex.</p>
        </div>
      </div>
    </main>

    <script>
      const tabs = document.querySelectorAll('[role="tab"]');
      const panelsNodeList = document.querySelectorAll('[role="tabpanel"]');
      const panelsArray = Array.from(panelsNodeList);

      tabs.forEach((tab, i) => {
        const nextTab = i === tabs.length - 1 ? tabs[0] : tabs[i + 1];
        const prevTab = i === 0 ? tabs[tabs.length - 1] : tabs[i - 1];
        const ariaControl = tab.getAttribute("aria-controls");

        tab.addEventListener("keydown", (e) => {
          if (e.key === "ArrowLeft") {
            prevTab.focus();
            prevTab.removeAttribute("tabindex");
            tab.setAttribute("tabindex", -1);
          } else if (e.key === "ArrowRight") {
            nextTab.focus();
            nextTab.removeAttribute("tabindex");
            tab.setAttribute("tabindex", -1);
          }
        });

        tab.addEventListener("click", () => {
          const ariaSelected = document.querySelector('[aria-selected="true"]');
          const panel = document.getElementById(ariaControl);
          const panelIsHidden =
            panel.getAttribute("hidden") === null ? false : true;
          const notHiddenId = ariaSelected.getAttribute("aria-controls");
          const notHiddenPanel = document.getElementById(notHiddenId);
          if (panelIsHidden) {
            ariaSelected.setAttribute("aria-selected", false);
            ariaSelected.setAttribute("tabindex", -1);
            tab.setAttribute("aria-selected", true);
            tab.removeAttribute("tabindex");
            panel.removeAttribute("hidden");
            notHiddenPanel.setAttribute("hidden", "");
          }
        });
      });
    </script>
  </body>
</html>
